
![alt text](./source/readme-promo.jpg)

# –ü—Ä–æ–µ–∫—Ç FOX KIDS ONLINE 4
–ß–µ—Ç–≤–µ—Ä—Ç–∞—è –≤–µ—Ä—Å–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –∞–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∏—Ö –º—É–ª—å—Ç—Å–µ—Ä–∏–∞–ª–æ–≤ Fox Kids Online

üåé [–í–µ–±-—Å–∞–π—Ç –ø—Ä–æ–µ–∫—Ç–∞](https://foxkids-online.ru/)  
üíº [–°—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏](https://github.com/foxkids-online)  

## –û –ø—Ä–æ–µ–∫—Ç–µ
–ö–æ–¥ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã —Å–∞–π—Ç–∞ foxkids-online.ru  
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger –ø–æ –ø—É—Ç–∏ /docs

## –û–ø–∏—Å–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –ø—Ä–æ–µ–∫—Ç–∞

html - –ø–∞–ø–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞  
--static  
----css  
----js  
----sources  
------promos - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –ø—Ä–æ–º–æ  
------series - –∏–∑–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ —Å–µ—Ä–∏–∞–ª–æ–≤  
------site - –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞  
----favicon.ico  
src - –ø–∞–ø–∫–∞ —Å –ø—Ä–æ–µ–∫—Ç–æ–º –±–µ–∫–µ–Ω–¥–∞  
tests - –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã  


## –ü–æ–ª–µ–∑–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è –∏–∑ –∫–æ—Ä–Ω—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞)

–ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–≤

`python -m pytest -s`

–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∫ –∫–æ–¥—É

`poetry run pdoc --http 0.0.0.0:8000`

–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

`poetry run python -m foxkids`

–ó–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–∞ poetry-dotenv –¥–ª—è —á—Ç–µ–Ω–∏—è .env

`poetry self add poetry-dotenv-plugin`

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏

`pytest --cov=foxkids tests/ --cov-report html`

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π | –ó–Ω–∞—á–µ–Ω–∏–µ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
| --- | --- | --- |
| ENV_FOR_DYNACONF | production, development,   test | –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Å—Ä–µ–¥—ã —Å—Ç–µ–Ω–¥–∞ |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–°–∫—Ä–∏–ø—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ settings.  
–í–Ω—É—Ç—Ä–∏ config-files –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å–∞–º–∏ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:  

dev-setttings.yaml - –¥–µ–≤ —Å—Ä–µ–¥–∞  
test-settings.yaml - —Å—Ä–µ–¥–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Å –Ω–µ–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã  
prod-settings.yaml - –ø—Ä–æ–¥  

Dockerfile - –ø—Ä–æ–¥ —Å—Ä–µ–¥–∞
Dockerfile-dev - –¥–µ–≤ —Å—Ä–µ–¥–∞

| –ù–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π | –ó–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è                                                                       |
| ------------------- | ------------------------------- | ---------------------------------------------------------------- |
| COUNT_COMMERTIALS   | –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∫–ª–∞–º –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏ | 2                                                                |
| TIME_START          | –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞ —Å–µ—Ä–∏–π | 06:55                                                                      |
| STREAM_URL          | –∞–¥—Ä–µ—Å —Å—Ç—Ä–∏–º–∞ | rtmp://server_rtmp:1935/stream/test                                                 |
| MAIN_FOLDER         | –≥–ª–∞–≤–Ω–∞—è –ø–∞–ø–∫–∞ –æ–±–ª–∞–∫–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ | dev_mnt_sample/foxkids                                           |
| FILE_PROGRAM        | —Ñ–∞–π–ª –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–µ—Ä–µ–¥–∞—á | dev_mnt_sample/program.json                                               |
| FILE_SERIES         | —Ñ–∞–π–ª —Å —Å–µ—Ä–∏–∞–ª–∞–º–∏ | dev_mnt_sample/series.json                                                      |
| FILE_STREAM         | —Å–∫—Ä–∏–ø—Ç —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ | dev_mnt_sample/stream.sh                                                       |
| PROMO_FOLDER        | –ø–∞–ø–∫–∞ —Å –ø—Ä–æ–º–æ —Å–µ—Ä–∏–∞–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–ø–∫–∏ –æ–±–ª–∞–∫–∞ | reklama                                      |
| BLOCK_PROMO_FOLDER  | –ø–∞–ø–∫–∞ —Å –ø—Ä–æ–º–æ –±–ª–æ–∫–æ–≤ –≤–Ω—É—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–ø–∫–∏ –æ–±–ª–∞–∫–∞ | reklama_block                                  |
| COMMERTIALS_FOLDER  | –ø–∞–ø–∫–∞ —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö —Ä–µ–∫–ª–∞–º –≤–Ω—É—Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –ø–∞–ø–∫–∏ –æ–±–ª–∞–∫–∞ | reklama_random                               |
| PLAY_SCRIPT         | –º–∞—Å–∫–∞ —Å—Ç—Ä–æ–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–ø—É—Å–∫–∞ ffmpeg       | ffmpeg  -re -i {–∞–¥—Ä–µ—Å —Ñ–∞–π–ª–∞} -f flv {–∞–¥—Ä–µ—Å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏} |
| CURL_SCRIPT         | –∞–¥—Ä–µ—Å –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–º–æ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Ä–∏–∏ | –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Å—Ä–µ–¥—ã —Å—Ç–µ–Ω–¥–∞                   |
| PORT                | –ø–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏                   | –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Å—Ä–µ–¥—ã —Å—Ç–µ–Ω–¥–∞                   |

–ø–æ–ª–Ω—ã–π —à–∞–±–ª–æ–Ω –º–∞—Å–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞: 

`ffmpeg  -re -i {—Ñ–∞–π–ª} -c:a aac -c:v libx264 -b:v 200k -b:a 64K -r 25 -s 320x240 -f flv {–∞–¥—Ä–µ—Å —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏}`

–ø–æ–ª–Ω—ã–π –∞–¥—Ä–µ—Å —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ–º–æ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Ä–∏–∏

`curl -X POST https://reqbin.com/echo/post/json -H \"Content-Type: application/json\" -d '{{\"current_series\": \"{}\", \"next_series\": \"{}\"}}'`

## –õ–∏–Ω—Ç–µ—Ä—ã

`isort isort --settings-path pyproject.toml .`  - –æ—Ç—Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –∏ —Å–¥–µ–ª–∞–µ—Ç –∫—Ä–∞—Å–∏–≤—ã–µ –∏–º–ø–æ—Ä—Ç—ã –≤–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–∞—Ö  
`black -l 79 --preview .` –∏–ª–∏ `black --config pyproject.toml .`  - –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–¥  
`flake8 .`  - –ø—Ä–æ–≤–µ—Ä–∏—Ç –∫–æ–¥—Å—Ç–∞–π–ª  
`mypy . --ignore-missing-imports` –∏–ª–∏ `mypy --config pyproject.toml .`  - –ø—Ä–æ–≤–µ—Ä–∏—Ç —Ç–∏–ø–∏–∑–∞—Ü–∏—é  

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pre-commit —á–µ—Ä–µ–∑ `poetry add pre-commit`  
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å pre-commit —Ö—É–∫–∏ —á–µ—Ä–µ–∑ `pre-commit install`  
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–æ–º–º–∏—Ç–∞ –±—É–¥—É—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ö—É–∫–∏ –∏–∑ —Ñ–∞–π–ª–∞ `.pre-commit-config.yaml`  

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω—ã –¥–ª—è –¥–µ–ø–ª–æ—è 

–£—Å–ª–æ–≤–∏—è:
- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω docker
- —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω docker-compose

–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è $SSH_USER –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–π –º–∞—à–∏–Ω–µ:  
`useradd $SSH_USER`  

–í—ã–¥–∞—á–∞ –ø—Ä–∞–≤ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –Ω–∞ –ø–∞–ø–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è  
`sudo chown -R $SSH_USER: /home/$SSH_USER/*`  

–°–æ–∑–¥–∞–Ω–∏–µ –∫–ª—é—á–∞  (–≤—ã–ø–æ–ª–Ω—è—Ç—å –æ—Ç –ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–µ–Ω –∑–∞ –¥–µ–ø–ª–æ–π)
`ssh-keygen -t rsa -b 4096`  

–ó–∞–ø–∏—Å—å –∫–ª—é—á–∞ –≤ —Ñ–∞–π–ª  
`cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys`  

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–∞, –æ–Ω –∂–µ –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π $SSH_KEY*
`cat ~/.ssh/id_rsa`  

–ù–∞ —Å–∞–º–æ–π –º–∞—à–∏–Ω–µ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–∞–≤–∞ –Ω–∞ –¥–æ–∫–µ—Ä  
`sudo chown $SSH_USER /var/run/docker.sock`  

–í–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ `/home/$SSH_USER/` , —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É $WORKDIR –∫—É–¥–∞ –±—É–¥–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞




                    